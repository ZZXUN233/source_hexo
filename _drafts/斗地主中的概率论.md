---
layout: post
title: 斗地主中的概率论
author: zzxun
date: 2019-03-21 14:45:20
categories:
- 编程
tags:
- 斗地主中的概率论问题
---

# 斗地主中的一些概率问题

## 排列

### 将$n$个不同元素进行排列

可以想象成$n$个人坐$n$个位子有多少种情况：

1. 第一个位子有$n$种情况可供选择
2. 第二个位子有$(n-1)$
3. 第三个位子有$(n-2)$
4. ...
5. 最后一个位子刚好坐最后$1$个人

总的有$n\cdot(n-1)\cdot(n-2)\cdot{\ldots}\cdot(1)=n!$种情况，这就是$n$个元素的全排列。

### 从$n$个不同的元素中取出$m$个进行排列

可以想象成$n$个人坐$m$个座位有多少种情况（同上面的分析）：

1. 第一个位子有$n$种情况可供选择
2. 第二个位子有$(n-1)$
3. 第三个位子有$(n-2)$
4. ...
5. 第$m$个座位有$(n-m+1)$种情况

总共有 $n\cdot(n-1)\cdot(n-2){\ldots}\cdot(n-m+1) = \frac{n!}{(n-m)!}$ 种情况，读作从$n$个不同元素种取出$m$个元素的排列，记作：
$$
A_{n}^{m} = \frac{n!}{(n-m)!}
$$

## 组合

### $n$个不同元素的组合

顾名思义，将$n$个元素放在一个集合中，自然只有$1$种情况。$C_n^n=1$

### 从$n$个不同元素取出$m$个进行组合

可以想象成从$n$个学生中划分出$m$个来，有多少种情况，接着按照上面排列的过程来：

1. 第一个名额有$n$种情况可供选择
2. 第二个名额有$(n-1)$
3. 第三个名额有$(n-2)$
4. ...
5. 第$m$个名额有$(n-m+1)$种情况

到这里可能会觉得和前面的排列一模一样，要注意这里只要求划分出$m$个学生来(并没有顺序要求)，而模拟从第一个逐个往后面挑选学生的过程无意间给学生加上了顺序！这就是排列和组合最大的区别，对所选出元素是否有顺序要求。现在从$n$个学生中选出的$m$个是有顺序的，如果能想办法把顺序消除，那这$m$个学生就是一个组合而不是排列了，怎么消除顺序呢？

$m$个学生进行排列总共有$A_m^m = m!$中情况，如果不考虑它们的顺序，那么这些$m$个元素就看成一个集合也就是$C_m^m=1$，这样从$n$个元素中就能取出$\frac{A_n^m}{A_m^m}$组不同的$m$个元素。这就是对这$m$个元素进行消除顺序的处理。

从$n$个元素中取出$m$个进行组合，记作：
$$
C_n^m = \frac{A_n^m}{A_m^m} = \frac{n!}{(n-m)!}\cdot\frac{1}{m!} = \frac{n!}{(n-m)!m!}{，(m!是消除顺序的作用)}
$$

## 具体的一些问题

### 一般排列组合问题

+ 手牌的所有可能情况

    在底牌没有翻开的情况下，手牌的所有可能情况就是从54张牌中随机抽取17张牌进行组合，有$\binom{17}{54}=C_{54}^{17}=\frac{A_{54}^{17}}{17!}=\frac{54!}{(54-17)!17!}$种情况。

+ 摸到某张手牌的可能

    可以从以下思路进行计算：

    1. 已经摸到某张牌了，还有16张牌不确定，所以摸到某张牌的概率就是从剩余的53张牌中继续挑选16张牌进行组合的情况占所有可能摸到手牌的情况。结果:$\frac{C_{53}^{16}}{C_{54}^{17}} = \frac{17}{54}$

    2. 手牌要摸17张（样本子集数），总牌数54张（样本空间），摸到任意一张牌的概率都是$\frac{17}{54}$

    3. 每一张牌在摸牌结束后只有四种归宿，在玩家1~3手中或是在地主底牌中，在某个玩家手中的概率自然就是$\frac{1}{3}$乘上该牌不在地主牌堆中的概率。结果：$\frac{1}{3}\times(1-\frac{3}{54})=\frac{17}{54}$

+ 底牌中出现某张牌的概率：

    底牌的所有可能性就是$C_{54}^{3}=24804$，底牌中出现某张牌的概率就是$\frac{C_{53}^{2}}{C_{54}^{3}}$就是$\frac{3}{54}$。

有了到这里的铺垫就可以解决下面的问题了。

## 具体的问题

+ 摸到**王炸**的概率是多少？

>摸到第一张王的概率是$\frac{17}{54}$，再摸到第二张王的概率是$\frac{16}{53}$，它们是彼此独立的事件，所以摸到王炸的概率就是两个事件发生概率的乘积$\frac{17}{54}\times\frac{16}{53}\approx9.5\%$，也可以表示为$\frac{C_{52}^{15}}{C_{54}^{17}}$，根据每张牌的归宿来算为$\frac{1}{3}\times\frac{54-3}{54}\times\frac{1}{3}\times\frac{51-3}{54}$，注意每算一次$\frac{1}{3}$牌堆都要减去3张牌，第一轮减去三张牌是因为抽出三张做底牌，后面每一轮必然发出3张牌，你才有$\frac{1}{3}$的概率获得其中一张。

+ 摸到**普通炸弹**的概率是多少？
    1. 摸到$1$个炸弹$P(A_1)$： $C_{13}^{1}\times\frac{C_{54-4}^{17-4}}{C_{54}^{17}}=13\times\frac{17\times16\times15\times14}{54\times53\times52\times51}\approx9.78\%$，同样可以用之前的思路解决，每一张牌有四种归宿，四张都发到同一个玩家手中的概率是$C_{13}^{1}(\frac{1}{3})^4\times(\frac{(54-3)\times(51-3)\times(48-3)\times(45-3)}{54\times53\times52\times51})\approx9.78\%$
    2. 摸到$2$个炸弹$P(A_2)$: $C_{13}^{2}\times\frac{C_{54-8}^{17-8}}{C_{54}^{17}}\approx{0.182\%}$
    3. 摸到$3$个炸弹$P(A_3)$:$C_{13}^{3}\times\frac{C_{54-12}^{17-12}}{C_{54}^{17}}$ 这个概率已经非常小了，基本上可以忽略不记了。
    4. 最多摸到4个炸弹$P(A_4)$: ${C_{13}^{4}}\times\frac{C_{54-16}^{17-16}}{C_{54}^{17}}$。
    5. 摸到普通炸弹的概率为$P=P(A_1)\bigcup{P(A_2)}\bigcup{P(A_3)}\bigcup{P(A_4)}=P(A_1)+P(A_2)+P(A_3)+P(A_4)$这个概率会略微大于$9.78\%$一丢丢：这里需要搞清楚一个问题**摸到一个炸弹和摸到两个炸弹这两个事件是什么关系？**先提出下面的问题：
        1. 已经摸到一个炸弹$P(B)$，再摸到一个炸弹$P(A|B)$的概率是多少？现在已知摸到两个炸弹的概率$P(AB)$，则$P(A|B)=\frac{P(AB)}{P(B)}\approx{1.86\%}$，这是典型的条件概率
        2. 直接摸到两个炸弹其实和摸到一个炸弹的关系是并列的，因为摸到前一个炸弹并不影响后面再摸到一个炸弹的概率。

+ 摸到**炸弹**的概率是多少？
+ 摸到**3~A顺子**的概率是多少？
+ 摸到至少3个两对的概率是多少

总结一下几个重要的概率：

1. 抓到双王的概率：
2. 拿到底牌后组成双王的概率：
3. 出现炸弹的概率：
4. 两个及以上炸弹的概率：
5. 抓到一个炸弹的概率：
6. 拿底牌后获得炸弹的概率：

## 胜率评估模型

### 必胜牌

什么样的牌型组合是必胜牌？首先分析下必胜包含些什么条件：

1. 能优先于对家将牌全部打出
2. 能掌握一定的出牌主动权

### 必输牌

同样有一部分牌时必输牌。

### 普通牌

真正体现打牌技术的就是普通牌，

## 斗地主中的终极问题

### 某种牌局下抢地主后的胜率会如何波动

加上三张随机自己没有的牌，牌的胜率会怎么波动？

### 不同组合切牌后对应的胜率如何评估

同样的一手牌，以不同的形式拆牌，对牌的胜率会造成什么影响？

### 拿到这样一幅手牌的胜率大概是多少

如何评估一手手牌的胜率如何？